<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Pendulum Simulation | Physics Lab</title>
     <link rel="icon" type="image/png" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjUgMTUuNUwxMiAxNEwxMy41IDE1LjVMMTUgMTdIMThWMTVIMTZMMTQuNSAxMy41TDE2IDEyTDE0LjUgMTAuNUwxMyA5VjZIMTFWOUw5LjUgMTAuNUw4IDEyTDkuNSAxMy41TDggMTVINlYxN0g4TDkuNSAxNS41Wk0xMiAyMkM2LjQ3NyAyMiAyIDE3LjUyMyAyIDEyQzIgNi40NzcgNi40NzcgMiAxMiAyQzE3LjUyMyAyIDIyIDYuNDc3IDIyIDEyQzIyIDE3LjUyMyAxNy41MjMgMjIgMTIgMjJaTTQgMTJDNCAxNi40MTggNy41ODIgMjAgMTIgMjBDMTYuNDE4IDIwIDIwIDE2LjQxOCAyMCAxMkMyMCA3LjU4MiAxNi40MTggNCAxMiA0QzcuNTgyIDQgNCA3LjU4MiA0IDEyWiIgZmlsbD0iIzRBNkZGRiIvPgo8L3N2Zz4=">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #2c3e50;
            --accent: #e74c3c;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --success: #28a745;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: var(--light);
            color: var(--dark);
            transition: var(--transition);
        }

        body.dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo img {
            height: 50px;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Main Content Layout */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 25px;
            margin: 25px 0;
        }

        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Simulation Area */
        .simulation-area {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            position: relative;
        }

        body.dark-mode .simulation-area {
            background: #1e1e1e;
        }

        .canvas-container {
            position: relative;
            width: 100%;
            height: 600px;
            background: #f0f8ff;
        }

        body.dark-mode .canvas-container {
            background: #0a1929;
        }

        #sim-canvas {
            width: 100%;
            height: 100%;
        }

        .sim-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--box-shadow);
            z-index: 10;
        }

        body.dark-mode .sim-overlay {
            background: rgba(30,30,30,0.9);
        }

        .overlay-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .overlay-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
        }

        .overlay-btn.active {
            background: var(--accent);
        }

        .overlay-btn:hover {
            background: var(--primary-dark);
        }

        /* Controls Panel */
        .controls-panel {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }

        body.dark-mode .controls-panel {
            background: #1e1e1e;
        }

        .panel-header {
            background: var(--secondary);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-content {
            padding: 20px;
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-title {
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .slider-control {
            display: grid;
            grid-template-columns: 1fr 80px;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }

        .slider-control label {
            font-size: 0.95rem;
        }

        .slider-control input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e9ecef;
            outline: none;
        }

        body.dark-mode .slider-control input[type="range"] {
            background: #333;
        }

        .slider-control input[type="text"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: var(--border-radius);
            text-align: center;
        }

        body.dark-mode .slider-control input[type="text"] {
            background: #333;
            border-color: #444;
            color: #e0e0e0;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .preset-btn {
            background: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: var(--border-radius);
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        body.dark-mode .preset-btn {
            background: #333;
            border-color: #444;
        }

        .preset-btn:hover {
            background: #dee2e6;
        }

        body.dark-mode .preset-btn:hover {
            background: #3a3a3a;
        }

        .preset-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Physics Info */
        .physics-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .info-card {
            background: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        body.dark-mode .info-card {
            background: #252525;
        }

        .info-card h3 {
            font-size: 1rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .info-value {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--secondary);
        }

        body.dark-mode .info-value {
            color: #e0e0e0;
        }

        .info-unit {
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* Educational Content */
        .educational-content {
            margin: 25px 0;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
        }

        .content-section {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            margin-bottom: 25px;
        }

        body.dark-mode .content-section {
            background: #1e1e1e;
        }

        .section-header {
            background: var(--primary);
            color: white;
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-content {
            padding: 20px;
            border-top: 1px solid #e9ecef;
        }

        body.dark-mode .section-content {
            border-top: 1px solid #333;
        }

        .equation {
            background: #f8f9fa;
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 15px 0;
            font-family: monospace;
            font-size: 1.1rem;
            text-align: center;
        }

        body.dark-mode .equation {
            background: #252525;
        }

        /* Footer */
        footer {
            background: var(--secondary);
            color: white;
            padding: 25px 0;
            margin-top: 40px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
        }

        @media (max-width: 768px) {
            .footer-content {
                grid-template-columns: 1fr;
            }
        }

        .footer-section h3 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 8px;
        }

        .footer-links a {
            color: #bbbbbb;
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: white;
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            margin-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: #bbbbbb;
            font-size: 0.9rem;
        }

        /* Buttons */
        .btn {
            display: inline-block;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-accent {
            background: var(--accent);
        }

        .btn-accent:hover {
            background: #c0392b;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        /* Utility Classes */
        .icon {
            margin-right: 8px;
        }

        .hidden {
            display: none;
        }

        /* Animation for the pendulum */
        @keyframes pendulum-swing {
            0% { transform: rotate(-30deg); }
            50% { transform: rotate(30deg); }
            100% { transform: rotate(-30deg); }
        }

        .pendulum-icon {
            display: inline-block;
            animation: pendulum-swing 2s infinite ease-in-out;
            transform-origin: top center;
            font-size: 1.5rem;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-atom pendulum-icon"></i>
                    <h1>Advanced Pendulum Simulation</h1>
                </div>
                <div class="header-controls">
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="main-content">
            <!-- Simulation Area -->
            <div class="simulation-area">
                <div class="canvas-container">
                    <canvas id="sim-canvas"></canvas>
                    <div class="sim-overlay">
                        <h3>Visualization Options</h3>
                        <div class="overlay-controls">
                            <button class="overlay-btn active" id="showVectors">
                                <i class="fas fa-arrows-alt"></i> Vectors
                            </button>
                            <button class="overlay-btn" id="showEnergy">
                                <i class="fas fa-bolt"></i> Energy Graph
                            </button>
                            <button class="overlay-btn" id="showTrail">
                                <i class="fas fa-wave-square"></i> Trail
                            </button>
                            <button class="overlay-btn" id="showGrid">
                                <i class="fas fa-th"></i> Grid
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Controls Panel -->
            <div class="controls-panel">
                <div class="panel-header">
                    <i class="fas fa-sliders-h"></i>
                    <span>Simulation Controls</span>
                </div>
                <div class="panel-content">
                    <div class="control-group">
                        <div class="control-title">
                            <i class="fas fa-ruler"></i>
                            <span>Pendulum Properties</span>
                        </div>
                        <div class="slider-control">
                            <label>Length (m)</label>
                            <div>
                                <input type="range" min="1" max="5" step="0.1" value="2" id="lengthSlider">
                                <input type="text" value="2.0" id="lengthValue">
                            </div>
                        </div>
                        <div class="slider-control">
                            <label>Mass (kg)</label>
                            <div>
                                <input type="range" min="0.1" max="10" step="0.1" value="1" id="massSlider">
                                <input type="text" value="1.0" id="massValue">
                            </div>
                        </div>
                        <div class="slider-control">
                            <label>Damping</label>
                            <div>
                                <input type="range" min="0" max="1" step="0.01" value="0.05" id="dampingSlider">
                                <input type="text" value="0.05" id="dampingValue">
                            </div>
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="control-title">
                            <i class="fas fa-globe-americas"></i>
                            <span>Environment</span>
                        </div>
                        <div class="slider-control">
                            <label>Gravity (m/s²)</label>
                            <div>
                                <input type="range" min="1" max="20" step="0.1" value="9.8" id="gravitySlider">
                                <input type="text" value="9.8" id="gravityValue">
                            </div>
                        </div>
                        <div class="slider-control">
                            <label>Drive Amplitude</label>
                            <div>
                                <input type="range" min="0" max="5" step="0.1" value="0" id="driveAmpSlider">
                                <input type="text" value="0.0" id="driveAmpValue">
                            </div>
                        </div>
                        <div class="slider-control">
                            <label>Drive Frequency</label>
                            <div>
                                <input type="range" min="0" max="2" step="0.01" value="0.5" id="driveFreqSlider">
                                <input type="text" value="0.50" id="driveFreqValue">
                            </div>
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="control-title">
                            <i class="fas fa-cogs"></i>
                            <span>Simulation Settings</span>
                        </div>
                        <div class="slider-control">
                            <label>Time Step</label>
                            <div>
                                <input type="range" min="0.001" max="0.1" step="0.001" value="0.02" id="timeStepSlider">
                                <input type="text" value="0.020" id="timeStepValue">
                            </div>
                        </div>
                        <div class="slider-control">
                            <label>Time Rate</label>
                            <div>
                                <input type="range" min="0.1" max="5" step="0.1" value="1" id="timeRateSlider">
                                <input type="text" value="1.0" id="timeRateValue">
                            </div>
                        </div>
                        <div style="margin-top: 15px;">
                            <label>
                                <input type="checkbox" id="limitAngle" checked>
                                Limit Angle (±180°)
                            </label>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Initial Conditions</h3>
                        <div class="preset-buttons">
                            <div class="preset-btn active" data-angle="0.3" data-velocity="0">
                                Small Angle
                            </div>
                            <div class="preset-btn" data-angle="1" data-velocity="0">
                                Medium Angle
                            </div>
                            <div class="preset-btn" data-angle="3" data-velocity="0">
                                Large Angle
                            </div>
                            <div class="preset-btn" data-angle="0" data-velocity="8">
                                High Velocity
                            </div>
                        </div>
                    </div>

                    <div class="physics-info">
                        <div class="info-card">
                            <h3>Angle</h3>
                            <div class="info-value" id="angleValue">0.0°</div>
                        </div>
                        <div class="info-card">
                            <h3>Angular Velocity</h3>
                            <div class="info-value" id="velocityValue">0.0 rad/s</div>
                        </div>
                        <div class="info-card">
                            <h3>Kinetic Energy</h3>
                            <div class="info-value" id="kineticValue">0.0 J</div>
                        </div>
                        <div class="info-card">
                            <h3>Potential Energy</h3>
                            <div class="info-value" id="potentialValue">0.0 J</div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn" id="restartBtn">
                            <i class="fas fa-redo"></i> Restart
                        </button>
                        <button class="btn btn-accent" id="pauseBtn">
                            <i class="fas fa-pause"></i> Pause
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Educational Content -->
        <div class="educational-content">
            <div class="section-title">
                <i class="fas fa-graduation-cap"></i>
                <h2>Pendulum Physics Explained</h2>
            </div>

            <div class="content-section">
                <div class="section-header" id="equationHeader">
                    <span>Equation of Motion</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="section-content" id="equationContent">
                    <p>The motion of a simple pendulum is governed by the following differential equation:</p>
                    <div class="equation">
                        \(\frac{d^2\theta}{dt^2} + \frac{b}{m} \frac{d\theta}{dt} + \frac{g}{L} \sin\theta = 0\)
                    </div>
                    <p>Where:</p>
                    <ul>
                        <li>\(\theta\) is the angular displacement</li>
                        <li>\(m\) is the mass of the bob</li>
                        <li>\(L\) is the length of the pendulum</li>
                        <li>\(g\) is the acceleration due to gravity</li>
                        <li>\(b\) is the damping coefficient</li>
                    </ul>
                    <p>For small angles (\(\sin\theta \approx \theta\)), this simplifies to the equation for simple harmonic motion.</p>
                </div>
            </div>

            <div class="content-section">
                <div class="section-header" id="energyHeader">
                    <span>Energy Conservation</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="section-content" id="energyContent">
                    <p>In an ideal pendulum with no friction, the total mechanical energy is conserved:</p>
                    <div class="equation">
                        \(E_{\text{total}} = KE + PE = \frac{1}{2} m v^2 + m g h\)
                    </div>
                    <p>Where:</p>
                    <ul>
                        <li>\(KE\) is the kinetic energy</li>
                        <li>\(PE\) is the potential energy</li>
                        <li>\(v\) is the tangential velocity</li>
                        <li>\(h\) is the height above the lowest point</li>
                    </ul>
                    <p>At the highest point, kinetic energy is zero and potential energy is maximum. At the lowest point, potential energy is zero and kinetic energy is maximum.</p>
                </div>
            </div>

            <div class="content-section">
                <div class="section-header" id="applicationsHeader">
                    <span>Real-World Applications</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="section-content" id="applicationsContent">
                    <p>Pendulums have numerous practical applications:</p>
                    <ul>
                        <li><strong>Clocks:</strong> Pendulum clocks use the regular motion of a pendulum to keep time</li>
                        <li><strong>Seismometers:</strong> Measure ground motion during earthquakes</li>
                        <li><strong>Metronomes:</strong> Help musicians keep a steady tempo</li>
                        <li><strong>Physics education:</strong> Demonstrate harmonic motion, energy conservation, and chaos theory</li>
                        <li><strong>Engineering:</strong> Used in vibration analysis and structural engineering</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About This Simulation</h3>
                    <p>This advanced pendulum simulation demonstrates the physics of harmonic motion, energy conservation, and chaotic systems. It was developed for educational purposes using JavaScript and Canvas API.</p>
                </div>
                <div class="footer-section">
                    <h3>Resources</h3>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fas fa-book icon"></i> Pendulum Physics</a></li>
                        <li><a href="#"><i class="fas fa-file-pdf icon"></i> Download PDF Guide</a></li>
                        <li><a href="#"><i class="fas fa-code icon"></i> Source Code</a></li>
                        <li><a href="#"><i class="fas fa-video icon"></i> Tutorial Videos</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Related Simulations</h3>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fas fa-chevron-right icon"></i> Double Pendulum</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right icon"></i> Spring-Mass System</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right icon"></i> Planetary Orbits</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right icon"></i> Wave Interference</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                &copy; 2023 Advanced Physics Simulations | Created for educational purposes
            </div>
        </div>
    </footer>

    <script>
        const themeToggle = document.getElementById('themeToggle');
        const canvas = document.getElementById('sim-canvas');
        const ctx = canvas.getContext('2d');
        
        let animationId;
        let isPaused = false;
        let showVectors = true;
        let showEnergy = false;
        let showTrail = true;
        let showGrid = true;
        
        let pendulum = {
            angle: Math.PI/4,
            length: 2,
            mass: 1,
            angularVelocity: 0,
            gravity: 9.8,
            damping: 0.05,
            driveAmplitude: 0,
            driveFrequency: 0.5,
            timeStep: 0.02,
            timeRate: 1,
            pivotX: 0,
            pivotY: 0,
            bobX: 0,
            bobY: 0,
            trail: []
        };
        
        const MAX_TRAIL_POINTS = 100;
        
        function initSimulation() {
            resizeCanvas();
            updatePendulumPosition();
            animate();
            setupEventListeners();
        }
        
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            pendulum.pivotX = canvas.width / 2;
            pendulum.pivotY = canvas.height * 0.2;
        }
        
        function updatePendulumPosition() {
            pendulum.bobX = pendulum.pivotX + pendulum.length * 100 * Math.sin(pendulum.angle);
            pendulum.bobY = pendulum.pivotY + pendulum.length * 100 * Math.cos(pendulum.angle);
        }
        
        function animate() {
            if (!isPaused) {
                updatePhysics();
            }
            draw();
            animationId = requestAnimationFrame(animate);
        }
        
        function updatePhysics() {
            const angularAcceleration = 
                (-pendulum.gravity / pendulum.length) * Math.sin(pendulum.angle) 
                - pendulum.damping * pendulum.angularVelocity 
                + pendulum.driveAmplitude * Math.sin(pendulum.driveFrequency * performance.now() / 1000);
            pendulum.angularVelocity += angularAcceleration * pendulum.timeStep * pendulum.timeRate;
            pendulum.angle += pendulum.angularVelocity * pendulum.timeStep * pendulum.timeRate;
            updatePendulumPosition();
            if (showTrail) {
                pendulum.trail.push({x: pendulum.bobX, y: pendulum.bobY});
                if (pendulum.trail.length > MAX_TRAIL_POINTS) {
                    pendulum.trail.shift();
                }
            } else {
                pendulum.trail = [];
            }
            updateDisplayValues();
        }
        
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (showGrid) {
                drawGrid();
            }
            if (showTrail && pendulum.trail.length > 1) {
                drawTrail();
            }
            drawPendulum();
            if (showVectors) {
                drawVectors();
            }
            if (showEnergy) {
                drawEnergyGraph();
            }
        }
        
        function drawPendulum() {
            ctx.beginPath();
            ctx.moveTo(pendulum.pivotX, pendulum.pivotY);
            ctx.lineTo(pendulum.bobX, pendulum.bobY);
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(pendulum.pivotX, pendulum.pivotY, 8, 0, Math.PI * 2);
            ctx.fillStyle = '#333';
            ctx.fill();
            const bobRadius = 15 + pendulum.mass * 2;
            ctx.beginPath();
            ctx.arc(pendulum.bobX, pendulum.bobY, bobRadius, 0, Math.PI * 2);
            ctx.fillStyle = '#e74c3c';
            ctx.fill();
            ctx.strokeStyle = '#c0392b';
            ctx.lineWidth = 2;
            ctx.stroke();
        }
        
        function drawVectors() {
            const scale = 10;
            const velX = pendulum.angularVelocity * pendulum.length * 100 * Math.cos(pendulum.angle);
            const velY = -pendulum.angularVelocity * pendulum.length * 100 * Math.sin(pendulum.angle);
            drawArrow(pendulum.bobX, pendulum.bobY, 
                      pendulum.bobX + velX * scale, 
                      pendulum.bobY + velY * scale, 
                      '#2ecc71');
            const centripetalAcc = pendulum.angularVelocity * pendulum.angularVelocity * pendulum.length * 100;
            const tangentialAcc = (-pendulum.gravity * Math.sin(pendulum.angle) / pendulum.length) * pendulum.length * 100;
            const accX = centripetalAcc * Math.cos(pendulum.angle) - tangentialAcc * Math.sin(pendulum.angle);
            const accY = centripetalAcc * Math.sin(pendulum.angle) + tangentialAcc * Math.cos(pendulum.angle);
            drawArrow(pendulum.bobX, pendulum.bobY, 
                      pendulum.bobX + accX * scale, 
                      pendulum.bobY + accY * scale, 
                      '#3498db');
        }
        
        function drawArrow(fromX, fromY, toX, toY, color) {
            const headLength = 15;
            const angle = Math.atan2(toY - fromY, toX - fromX);
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(
                toX - headLength * Math.cos(angle - Math.PI/6),
                toY - headLength * Math.sin(angle - Math.PI/6)
            );
            ctx.lineTo(
                toX - headLength * Math.cos(angle + Math.PI/6),
                toY - headLength * Math.sin(angle + Math.PI/6)
            );
            ctx.closePath();
            ctx.fillStyle = color;
            ctx.fill();
        }
        
        function drawTrail() {
            ctx.beginPath();
            ctx.moveTo(pendulum.trail[0].x, pendulum.trail[0].y);
            for (let i = 1; i < pendulum.trail.length; i++) {
                const alpha = i / pendulum.trail.length;
                ctx.strokeStyle = `rgba(52, 152, 219, ${alpha})`;
                ctx.lineWidth = 2 * alpha;
                ctx.lineTo(pendulum.trail[i].x, pendulum.trail[i].y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(pendulum.trail[i].x, pendulum.trail[i].y);
            }
        }
        
        function drawGrid() {
            const spacing = 50;
            ctx.strokeStyle = 'rgba(200, 200, 200, 0.3)';
            ctx.lineWidth = 1;
            for (let x = 0; x < canvas.width; x += spacing) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y < canvas.height; y += spacing) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }
        
        function drawEnergyGraph() {
            const width = 200;
            const height = 80;
            const x = canvas.width - width - 20;
            const y = 20;
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(x, y, width, height);
            const heightAboveLowest = pendulum.length * 100 * (1 - Math.cos(pendulum.angle));
            const potentialEnergy = pendulum.mass * pendulum.gravity * heightAboveLowest / 100;
            const velocity = pendulum.angularVelocity * pendulum.length;
            const kineticEnergy = 0.5 * pendulum.mass * velocity * velocity;
            const totalEnergy = potentialEnergy + kineticEnergy;
            const maxEnergy = 30;
            const peHeight = (potentialEnergy / maxEnergy) * (height - 10);
            const keHeight = (kineticEnergy / maxEnergy) * (height - 10);
            const teHeight = (totalEnergy / maxEnergy) * (height - 10);
            ctx.fillStyle = 'rgba(46, 204, 113, 0.6)';
            ctx.fillRect(x + 20, y + height - peHeight, 30, peHeight);
            ctx.fillStyle = 'rgba(231, 76, 60, 0.6)';
            ctx.fillRect(x + 70, y + height - keHeight, 30, keHeight);
            ctx.fillStyle = 'rgba(52, 152, 219, 0.6)';
            ctx.fillRect(x + 120, y + height - teHeight, 30, teHeight);
            ctx.fillStyle = 'white';
            ctx.font = '12px Arial';
            ctx.fillText('PE', x + 25, y + height + 15);
            ctx.fillText('KE', x + 75, y + height + 15);
            ctx.fillText('TE', x + 125, y + height + 15);
        }
        
        function updateDisplayValues() {
            const heightAboveLowest = pendulum.length * (1 - Math.cos(pendulum.angle));
            const potentialEnergy = pendulum.mass * pendulum.gravity * heightAboveLowest;
            const velocity = pendulum.angularVelocity * pendulum.length;
            const kineticEnergy = 0.5 * pendulum.mass * velocity * velocity;
            document.getElementById('angleValue').textContent = (pendulum.angle * 180 / Math.PI).toFixed(1) + '°';
            document.getElementById('velocityValue').textContent = pendulum.angularVelocity.toFixed(2) + ' rad/s';
            document.getElementById('kineticValue').textContent = kineticEnergy.toFixed(2) + ' J';
            document.getElementById('potentialValue').textContent = potentialEnergy.toFixed(2) + ' J';
        }
        
        function setupEventListeners() {
            themeToggle.addEventListener('click', toggleTheme);
            document.getElementById('pauseBtn').addEventListener('click', togglePause);
            document.getElementById('restartBtn').addEventListener('click', restartSimulation);
            document.getElementById('showVectors').addEventListener('click', () => {
                showVectors = !showVectors;
                toggleButtonActive('showVectors', showVectors);
            });
            document.getElementById('showEnergy').addEventListener('click', () => {
                showEnergy = !showEnergy;
                toggleButtonActive('showEnergy', showEnergy);
            });
            document.getElementById('showTrail').addEventListener('click', () => {
                showTrail = !showTrail;
                toggleButtonActive('showTrail', showTrail);
            });
            document.getElementById('showGrid').addEventListener('click', () => {
                showGrid = !showGrid;
                toggleButtonActive('showGrid', showGrid);
            });
            setupSliders();
            setupPresetButtons();
            setupCollapsibles();
            window.addEventListener('resize', resizeCanvas);
        }
        
        function toggleButtonActive(id, isActive) {
            const button = document.getElementById(id);
            if (isActive) {
                button.classList.add('active');
            } else {
                button.classList.remove('active');
            }
        }
        
        function setupSliders() {
            const lengthSlider = document.getElementById('lengthSlider');
            const lengthValue = document.getElementById('lengthValue');
            lengthSlider.addEventListener('input', () => {
                pendulum.length = parseFloat(lengthSlider.value);
                lengthValue.value = pendulum.length.toFixed(1);
                updatePendulumPosition();
            });
            const massSlider = document.getElementById('massSlider');
            const massValue = document.getElementById('massValue');
            massSlider.addEventListener('input', () => {
                pendulum.mass = parseFloat(massSlider.value);
                massValue.value = pendulum.mass.toFixed(1);
            });
            const dampingSlider = document.getElementById('dampingSlider');
            const dampingValue = document.getElementById('dampingValue');
            dampingSlider.addEventListener('input', () => {
                pendulum.damping = parseFloat(dampingSlider.value);
                dampingValue.value = pendulum.damping.toFixed(2);
            });
            const gravitySlider = document.getElementById('gravitySlider');
            const gravityValue = document.getElementById('gravityValue');
            gravitySlider.addEventListener('input', () => {
                pendulum.gravity = parseFloat(gravitySlider.value);
                gravityValue.value = pendulum.gravity.toFixed(1);
            });
            const driveAmpSlider = document.getElementById('driveAmpSlider');
            const driveAmpValue = document.getElementById('driveAmpValue');
            driveAmpSlider.addEventListener('input', () => {
                pendulum.driveAmplitude = parseFloat(driveAmpSlider.value);
                driveAmpValue.value = pendulum.driveAmplitude.toFixed(1);
            });
            const driveFreqSlider = document.getElementById('driveFreqSlider');
            const driveFreqValue = document.getElementById('driveFreqValue');
            driveFreqSlider.addEventListener('input', () => {
                pendulum.driveFrequency = parseFloat(driveFreqSlider.value);
                driveFreqValue.value = pendulum.driveFrequency.toFixed(2);
            });
            const timeStepSlider = document.getElementById('timeStepSlider');
            const timeStepValue = document.getElementById('timeStepValue');
            timeStepSlider.addEventListener('input', () => {
                pendulum.timeStep = parseFloat(timeStepSlider.value);
                timeStepValue.value = pendulum.timeStep.toFixed(3);
            });
            const timeRateSlider = document.getElementById('timeRateSlider');
            const timeRateValue = document.getElementById('timeRateValue');
            timeRateSlider.addEventListener('input', () => {
                pendulum.timeRate = parseFloat(timeRateSlider.value);
                timeRateValue.value = pendulum.timeRate.toFixed(1);
            });
        }
        
        function setupPresetButtons() {
            const presetButtons = document.querySelectorAll('.preset-btn');
            presetButtons.forEach(button => {
                button.addEventListener('click', () => {
                    presetButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    const angle = parseFloat(button.dataset.angle);
                    const velocity = parseFloat(button.dataset.velocity);
                    pendulum.angle = angle;
                    pendulum.angularVelocity = velocity;
                    updatePendulumPosition();
                    pendulum.trail = [];
                });
            });
        }
        
        function setupCollapsibles() {
            const headers = document.querySelectorAll('.section-header');
            headers.forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    const icon = header.querySelector('i');
                    if (content.style.display === 'block') {
                        content.style.display = 'none';
                        icon.classList.remove('fa-chevron-up');
                        icon.classList.add('fa-chevron-down');
                    } else {
                        content.style.display = 'block';
                        icon.classList.remove('fa-chevron-down');
                        icon.classList.add('fa-chevron-up');
                    }
                });
            });
        }
        
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const icon = themeToggle.querySelector('i');
            if (document.body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
        }
        
        function togglePause() {
            isPaused = !isPaused;
            const button = document.getElementById('pauseBtn');
            const icon = button.querySelector('i');
            if (isPaused) {
                icon.classList.remove('fa-pause');
                icon.classList.add('fa-play');
                button.classList.remove('btn-accent');
            } else {
                icon.classList.remove('fa-play');
                icon.classList.add('fa-pause');
                button.classList.add('btn-accent');
            }
        }
        
        function restartSimulation() {
            pendulum.angle = Math.PI/4;
            pendulum.angularVelocity = 0;
            pendulum.trail = [];
            updatePendulumPosition();
        }
        
        window.addEventListener('load', initSimulation);
    </script>
</body>
</html>
